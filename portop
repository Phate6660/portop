#!/usr/bin/env sh

# Configuration
REFRESH_INTERVAL=1

# Source bashsimplecurses here
. "$(dirname "$0")"/bashsimplecurses/simple_curses.sh

# Main program loop. Run once per refresh
main (){
	window "$(hostname)" "blue"
	append_tabbed ":Portage Status:Core Frequencies:" "4"
	addsep
	append_tabbed "$(genlop -c)|$(grep 'cpu MHz' /proc/cpuinfo)" "2" "|"
	endwin

	window "emerge.log" "blue" "50%"
	tail -n 7 /var/log/emerge.log > /dev/shm/emerge.log
	append_file /dev/shm/emerge.log
	rm -f /dev/shm/emerge.log
	endwin

	# TODO: Decide on side-by-side, or top-bottom
	# Less output if top-bottom, but more girth
	col_right
	#move_up

	window "emerge-fetch.log" "blue" "50%"
	tail -n 7 /var/log/emerge-fetch.log > /dev/shm/emerge-fetch.log
	append_file /dev/shm/emerge-fetch.log
	rm -f /dev/shm/emerge-fetch.log
	endwin
}

case "$(id -u)" in
    0) main_loop $REFRESH_INTERVAL;;
    250) main_loop $REFRESH_INTERVAL;;
    *) echo "Must be run as portage or root!" && exit 1;;
esac
