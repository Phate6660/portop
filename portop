#!/usr/bin/env sh

# Configuration
REFRESH_INTERVAL=1

# TODO: Include check for portage(250) OR root(0)
if ! [ "$(id -u)" = 0 ]; then
	echo 'This program must be run as root.'
	exit 1
fi

# Source bashsimplecurses here
. "$(dirname "$0")"/bashsimplecurses/simple_curses.sh

# Main program loop. Run once per refresh
main (){
	window "$(hostname)" "blue"
	append_tabbed ":Portage Status:Core Frequencies:" "4"
	addsep
	append_tabbed "$(genlop -c)|$(grep 'cpu MHz' /proc/cpuinfo)" "2" "|"
	endwin

	window "emerge.log" "blue" "50%"
	tail -n 7 /var/log/emerge.log > /dev/shm/emerge.log
	append_file /dev/shm/emerge.log
	rm -f /dev/shm/emerge.log
	endwin

	# TODO: Decide on side-by-side, or top-bottom
	# Less output if top-bottom, but more girth
	col_right
	#move_up

	window "emerge-fetch.log" "blue" "50%"
	tail -n 7 /var/log/emerge-fetch.log > /dev/shm/emerge-fetch.log
	append_file /dev/shm/emerge-fetch.log
	rm -f /dev/shm/emerge-fetch.log
	endwin
}
main_loop $REFRESH_INTERVAL

# Finish up and exit
